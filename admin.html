<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Tambah Code</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* Custom CSS untuk animasi dan efek hover */
        .btn-primary {
            background: linear-gradient(45deg, #ff4081, #e91e63);
            color: white;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 64, 129, 0.4);
        }
        .btn-primary:active {
            transform: translateY(0);
            box-shadow: none;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">
    <div class="container max-w-2xl mx-auto">
        <!-- Header -->
        <h1 class="text-3xl font-bold text-center mb-6 bg-gradient-to-r from-pink-500 to-purple-500 bg-clip-text text-transparent">
            Tambah Code
        </h1>

        <!-- Form Input -->
        <div class="card p-6">
            <input
                type="text"
                id="codeName"
                placeholder="Nama kode (contoh: Login System)"
                class="w-full p-3 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 mb-4"
            />
            <textarea
                id="code"
                placeholder="Tulis kode di sini..."
                class="w-full p-3 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 mb-4"
                rows="8"
            ></textarea>
            <button
                id="upload"
                class="btn-primary w-full p-3 rounded-lg font-semibold"
            >
                Upload Code
            </button>
        </div>

        <!-- Result Section -->
        <div id="result" class="card p-6 mt-6 hidden">
            <h3 class="text-xl font-semibold mb-4">Link Code:</h3>
            <input
                type="text"
                id="codeLink"
                readonly
                class="w-full p-3 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 mb-4"
            />
            <button
                onclick="copyLink()"
                class="btn-primary w-full p-3 rounded-lg font-semibold"
            >
                Salin Link
            </button>
        </div>
    </div>

    <script>
        // Fungsi untuk upload code ke GitHub
        document.getElementById("upload").addEventListener("click", async function () {
            const codeName = document.getElementById("codeName").value.trim();
            const rawCode = document.getElementById("code").value.trim();
            if (!codeName || !rawCode) {
                Swal.fire("Oops!", "Nama kode dan kode tidak boleh kosong!", "warning");
                return;
            }

            const githubUsername = "kenz-publish";
            const repoName = "dbcode";
            const branch = "main";
            const timestamp = Date.now();
            const fileName = `codex${timestamp}.txt`;
            const token = "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";

            const fileContent = `// Nama: ${codeName}\n// Timestamp: ${timestamp}\n\n` + rawCode;
            const encodedContent = btoa(unescape(encodeURIComponent(fileContent)));
            const apiUrl = `https://api.github.com/repos/${githubUsername}/${repoName}/contents/${fileName}`;

            try {
                const response = await fetch(apiUrl, {
                    method: "PUT",
                    headers: {
                        Authorization: `token ${token}`,
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        message: `Upload ${codeName}`,
                        content: encodedContent,
                        branch,
                    }),
                });

                const result = await response.json();
                if (result.content) {
                    const rawUrl = `https://raw.githubusercontent.com/${githubUsername}/${repoName}/${branch}/${fileName}`;
                    document.getElementById("codeLink").value = rawUrl;
                    document.getElementById("result").style.display = "block";

                    let codeList = JSON.parse(localStorage.getItem("codeList")) || [];
                    codeList.push({ name: codeName, url: rawUrl });
                    localStorage.setItem("codeList", JSON.stringify(codeList));

                    Swal.fire("Sukses!", "Kode berhasil diupload!", "success");
                } else {
                    Swal.fire("Gagal!", "Terjadi kesalahan saat upload!", "error");
                }
            } catch (error) {
                Swal.fire("Gagal!", "Terjadi kesalahan saat upload!", "error");
            }
        });

        // Fungsi untuk menyalin link
        function copyLink() {
            const codeLink = document.getElementById("codeLink");
            codeLink.select();
            document.execCommand("copy");
            Swal.fire("Sukses!", "Link berhasil disalin!", "success");
        }
    </script>
</body>
</html>